# Changelog

## [0.15.0] - 2025-12-05

### Added

#### 本地会话置顶与管理

-   **本地置顶**: 支持将会话在本地置顶，优先级高于服务端置顶。
    -   即使服务端取消置顶，本地置顶依然有效。
    -   在会话列表下拉菜单中可进行置顶/取消置顶操作。
-   **置顶同步控制**: 在设置页面新增“同步服务端置顶”开关。
    -   关闭后，不再同步显示服务端的置顶状态，仅显示本地置顶会话。
    -   解决了服务端置顶无法在本地灵活管理的问题。
-   **会话筛选与分组**: 
    -   新增会话筛选功能（全部、聊天、置顶）。
    -   置顶会话支持折叠收起，方便查看普通会话。

#### 媒体体验增强

-   **Live Photo 支持**: `ImageViewer` 图片预览组件现在支持播放 Live Photo。
-   **视频播放**: 支持在预览组件中直接播放视频消息。
-   **媒体资源优化**: 
    -   引入缩略图显示，加快列表加载速度。
    -   代理媒体资源 URL，解决 Mixed Content 安全警告问题。

#### Dashboard 与 PWA

-   **Dashboard 重构**: 完成了 Dashboard 仪表盘页面的重新设计，展示更直观的统计信息。
-   **PWA 增强**: 
    -   新增 iOS PWA 安装引导。
    -   支持强制 Service Worker 注册，提升离线体验。

#### 消息体验

-   **URL 渲染**: 文本消息中的 URL 链接现在会自动识别并支持点击打开。
-   **消息分组优化**: 优化了消息列表的头像和名称显示逻辑，相同发送者的连续消息会合并显示头像。

### Changed

-   **架构重构**: 
    -   `SessionList` 组件逻辑完全重构，迁移至 `stores/session.ts` 统一管理。
    -   `Contact` 模块代码精简重构。
    -   前端 API 代码重构，提升可维护性。
-   **体验优化**: 
    -   静默刷新会话列表时不再显示加载骨架屏，减少视觉干扰。
    -   优化了图片加载属性 (`crossorigin`, `loading`)。

### Fixed

-   **安全修复**: 修复了 HTTP 环境下加载 HTTPS 图片导致的 Mixed Content 警告。
-   **代理修复**: 修复了开发环境代理基础路径配置问题。
-   **稳定性**: 
    -   修复了 Windows 系统托盘交互问题（服务端）。
    -   修复了图片 Key 不生效导致解密失败的问题。
    -   修复了 `TextMessage` 组件中 `key` 属性缺失导致的渲染警告。

### Technical Details

-   **类型系统**: 新增 `SessionFilterType` 和 `ContactFilterType` 类型定义。
-   **状态管理**: 会话状态（Session Store）增加了 `localPinnedSessions` 持久化存储支持。
-   **依赖更新**: 升级了 Vite, Sass, vue-tsc 等开发依赖，保持技术栈最新。

### User Experience

-   **灵活置顶**: 用户终于可以按需置顶重要的会话，而不受限于微信服务端的置顶列表。
-   **沉浸式媒体**: 直接在应用内预览 Live Photo 和视频，无需跳转或下载。
-   **流畅性**: 列表滚动和刷新的视觉体验更加平滑。

### Testing

-   [x] **本地置顶**
    -   [x] 验证本地置顶会话排在最前。
    -   [x] 验证关闭“同步服务端置顶”后，仅显示本地置顶。
    -   [x] 验证刷新页面后置顶状态保留。
-   [x] **媒体预览**
    -   [x] 验证 Live Photo 能正确加载视频部分。
    -   [x] 验证普通视频能正常播放。
-   [x] **会话列表**
    -   [x] 验证置顶分组折叠功能正常。
    -   [x] 验证无感知刷新时列表不闪烁。